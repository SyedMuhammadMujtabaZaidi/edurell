{% extends "layout.html" %}
{% set active_page = "burst" %}
  <head>

      {% block head %}
          {{ super() }}
          <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/form_video.css') }}"/>
          <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/video_annotator.css') }}"/>

          <script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
          <style>
          .concept{
                background-color: yellow;
            }

          #transcript p {
                margin-bottom:0;
          }
          </style>

      {% endblock %}



  </head>
  <body>
    {% block navbar %}{{ super() }}{% endblock %}
    {% block body %}

    {% with messages = get_flashed_messages(with_categories=true) %}
      <!-- Categories: success (green), info (blue), warning (yellow), danger (red) -->
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible" role="alert">
          <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <!-- <strong>Title</strong> --> {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div style="padding-left: 5%; padding-right: 5%;" >
        <div id="checkConcepts">
            <p class="title"> Launch burst analysis </p>
            <p> Add or remove concepts, then launch Burst Analysis</p>

            <div class="row" id="checkConcepts">

             <div  class="col-7">

                 <ul class="nav nav-tabs" id="myTab" role="tablist">
                      <li class="nav-item">
                        <a class="nav-link active" id="concepts-tab" data-toggle="tab" href="#concepts" role="tab" aria-controls="home" aria-selected="true">Concepts</a>
                      </li>
                      <li class="nav-item">
                        <a class="nav-link" id="add-tab" data-toggle="tab" href="#add" role="tab" aria-controls="profile" aria-selected="false">Add new concept</a>
                      </li>
                  </ul>

                  <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="concepts" role="tabpanel" aria-labelledby="concepts-tab" style="max-height:400px;overflow:auto;">

                        <div class="list-group list-group-flush" id="conceptsTable">

                        </div>
                    </div>
                    <div class="tab-pane fade" id="add" role="tabpanel" aria-labelledby="add-tab">
                      <div style="padding:7%;">

                        <div class="row">
                            <label for="newConcept">Concept:</label>
                            <input type="text" class="form-control" autocomplete="off" id="newConcept"  placeholder="Enter new concept">
                        </div>
                          <br>
                        <div class="row">
                            <button  onclick="addConcept()" class="btn btn-primary">Add concept</button>
                        </div>
                          <br>
                        <div class="row" id="errorConcept" style="display:none">
                        </div>
                      </div>
                    </div>
                  </div>



             </div>

              <div class="col">
                <p class="titleLower"> Transcript </p>
                <div id="transcript" style="overflow-y: scroll;max-height:400px"></div>
              </div>


            </div>
            <button  onclick="launchBurstAnalysis()" class="btn btn-primary" style="float: right;margin-top: 1%">Launch burst Analysis</button>


        </div>

        <div class="container" id="loading" style="display: none; margin-top: 2%">
            <div class="text-center" style="margin-top: 4%">
              <p class="titleLower"> Extracting burst.. </p>
              <div class="spinner-border text-primary" role="status">
                <span class="sr-only">Loading...</span>
              </div>
            </div>
        </div>

        <div class="container" id="results" style="display: none;">
            <p class="title"> Burst analysis results</p>

            <ul class="nav nav-tabs" id="myTab" role="tablist">
              <li class="nav-item">
                <a class="nav-link active" id="data_summary-tab"
                   data-toggle="tab" href="#summary" role="tab" aria-controls="home" aria-selected="true">Data Summary</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" id="defs-tab"
                   data-toggle="tab" href="#defs" role="tab" aria-controls="profile" aria-selected="false">Definitions</a>
              </li>
              <li class="nav-item" >
                <a class="nav-link" id="rels-tab"
                   data-toggle="tab" href="#rels" role="tab" aria-controls="contact" aria-selected="false">Relations</a>
              </li>
          </ul>

            <div class="tab-content" id="myTabContent">
            <div class="tab-pane fade show active" id="summary" role="tabpanel" aria-labelledby="data_summary-tab">
                <div id="data_summary"></div>
            </div>

            <div class="tab-pane fade" id="defs" role="tabpanel" aria-labelledby="defs-tab">
              <div style="padding:3%;">
                <div class="row">
                    <div id="video" class="col">
                    <video
                        id="video-active"
                        class="video-js video-player"
                        preload="none"
                        controls poster="https://img.youtube.com/vi/{{ video_id }}/maxresdefault.jpg" >
                    <source src="{{url_for('static', filename='videos/'+video_id+'/'+video_id+'.mp4')}}" type="video/mp4">
                    </video>
                 </div>


                    <div class="col" style="">
                    <table class="table" style="max-height:450px">
                      <thead>
                        <tr>
                          <th scope="col">Concept</th>
                          <th scope="col">Start</th>
                          <th scope="col">End</th>
                          <th scope="col">Type</th>
                          <th scope="col"></th>
                        </tr>
                      </thead>
                      <tbody id="defsTable">
                      </tbody>
                  </table>
                </div>
                </div>
              </div>
            </div>

            <div class="tab-pane fade" id="rels" role="tabpanel" aria-labelledby="rels-tab">
                <div id="network" style=""></div>
             </div>
          </div>






        </div>


    </div>






  {% endblock %}
  </body>

{% block scripts %}

<script src="{{ url_for('static', filename='burst.js') }}"></script>

<script src="{{ url_for('static', filename='graph_visualization.js') }}"></script>
<script>

    /*let relations = { { relations|tojson }};
    let definitions = { { definitions|tojson }};
    let concepts = { { concepts|tojson }};
    console.log(relations)
    console.log(concepts)
    console.log(definitions)

   showNetwork(concepts, relations, "relations")*/

    let $captions = {{ result|tojson }};
    let $concepts = {{ concepts|tojson }};
    $concepts.sort()

    let $lemmatizedSubs = {{ lemmatized_subtitles|tojson }};
    let $video_id = {{ video_id|tojson }};
    let $allLemmas = {{ all_lemmas|tojson }};

    let $typeAnalysis = {{ type|tojson }};
    let $title = {{ title|tojson }};

    if($typeAnalysis == "semi"){
        addSubtitles();
        printConcepts();
    }else{
        console.log($typeAnalysis)
        launchBurstAnalysis();
    }

    let video = document.getElementById("video-active");


    function loading(){
        document.getElementById("checkConcepts").style.display = "none"
        document.getElementById("loading").style.display = "block"
    }







</script>
{% endblock %}
